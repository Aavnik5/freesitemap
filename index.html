<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1E88F2M75S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1E88F2M75S');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>FreePornX | Free Porn Videos, free porn vidoes XXX Nude Photos, Savita & Velamma Comics PDF</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20384%20512'%3E%3Cpath%20fill%3D'%23dc3545'%20d%3D'M153.6%2029.9l-56.5%2056.5c-9.4%209.4-9.4%2024.6%200%2033.9l80%2080c9.4%209.4%2024.6%209.4%2033.9%200l56.5-56.5c9.4-9.4%209.4-24.6%200-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9%200zM64%20192c-35.3%200-64%2028.7-64%2064V448c0%2035.3%2028.7%2064%2064%2064H288c35.3%200%2064-28.7%2064-64V256c0-35.3-28.7-64-64-64H64zm256%2064H304c-8.8%200-16-7.2-16-16s7.2-16%2016-16h16c8.8%200%2016%207.2%2016%2016v32c0%208.8-7.2%2016-16%2016H288c-8.8%200-16%207.2-16%2016s7.2%2016%2016%2016h32c8.8%200%2016-7.2%2016-16s-7.2-16-16-16H304c-8.8%200-16%207.2-16%2016v64c0%208.8%207.2%2016%2016%2016h16c8.8%200%2016-7.2%2016-16V368c0-8.8-7.2-16-16-16H288c-8.8%200-16%207.2-16%2016s7.2%2016%2016%2016h32c8.8%200%2016-7.2%2016-16s-7.2-16-16-16z'%2F%3E%3C%2Fsvg%3E">
    
    <meta name="description" content="free porn x The best Free Porn xxx videos website Watch free desi viral porn videos, browse HD free xxx porn video , free porn nude photos gallery, free porn video download full episodes of Savita Bhabhi & Velamma comics PDF, and read hot desi sex stories. Daily free porn video updates.">
    <meta name="keywords" content="free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips">
    <meta name="author" content="Free PornX Entertainment">
    <meta name="robots" content="index, follow">
    <meta name="rating" content="RTA-5042-1996-1400-1577-RTA" />
    <meta name="rating" content="adult" />

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://freepornx.site/">
    <meta property="og:title" content="Free PornX | Free Porn videos, Nude Pics & Adult Comics">
    <meta property="og:description" content="Unlimited free access to Viral Porn, XXX Photos, Savita Bhabhi Comics PDF, and Sex Stories. No signup.">
    <meta property="og:image" content="https://freepornx.site/cover-adult.jpg"> 
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://freepornx.site/">
    <meta name="twitter:title" content="X-App | Porn Videos & Comics PDF">
    <meta name="twitter:description" content="Watch trending xxx shorts, view nude gallery, and read adult comics for free.">
    <meta name="twitter:image" content="https://freepornx.site/cover-adult.jpg">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="canonical" href="https://freepornx.site/">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Free PornX Entertainment",
      "url": "https://freepornx.site/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://freepornx.site/?search={search_term_string}",
        "query-input": "required name=search_term_string"
      },
      "description": "Free platform for porn videos, adult comics, nude photos, and sex stories."
    }
    </script>
    <meta name="6a97888e-site-verification" content="cec8799cf1dd48567a95406f5f0849c6">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
    <style>
        body, html { margin: 0; padding: 0; background-color: #000; height: 100%; overflow: hidden; color: white; font-family: system-ui, sans-serif; }
        .main-view { height: 100%; width: 100%; padding-top: 70px; padding-bottom: 60px; position: relative; overflow-y: auto; overscroll-behavior-y: contain; }
        #pull-to-refresh-indicator {
          position: absolute;
          top: -60px;
          left: 0;
          width: 100%;
          height: 60px;
          background: #1a1a1a;
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000;
          transition: top 0.3s ease;
        }
        #pull-to-refresh-indicator .spinner {
          animation: rotator 1.4s linear infinite;
          width: 50px;
          height: 50px;
        }
        @keyframes rotator {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(270deg); }
        }
        #pull-to-refresh-indicator .path {
          stroke-dasharray: 187;
          stroke-dashoffset: 0;
          transform-origin: center;
          animation:
            dash 1.4s ease-in-out infinite,
            colors 5.6s ease-in-out infinite;
        }
        @keyframes colors {
          0% { stroke: #4285F4; }
          25% { stroke: #DE3E35; }
          50% { stroke: #F7C223; }
          75% { stroke: #1B9A59; }
          100% { stroke: #4285F4; }
        }
        @keyframes dash {
          0% { stroke-dashoffset: 187; }
          50% {
            stroke-dashoffset: 46.75;
            transform:rotate(135deg);
          }
          100% {
            stroke-dashoffset: 187;
            transform:rotate(450deg);
          }
        }
        .grid-view { display: none; padding: 10px; }

        /* HEADER */
        .app-header { position: fixed; top: 0; left: 0; right: 0; background: rgba(0,0,0,0.8); z-index: 1000; padding-top: 10px; border-bottom: 1px solid #333; backdrop-filter: blur(5px); }
        .brand-logo { font-size: 18px; font-weight: 800; letter-spacing: 1px; }
        
        /* CHIPS */
        .category-scroll { display: flex; overflow-x: auto; padding: 10px 15px; gap: 10px; scrollbar-width: none; -ms-overflow-style: none; }
        .category-scroll::-webkit-scrollbar { display: none; }
        .chip { background: #333; border: 1px solid #444; color: #ccc; padding: 6px 16px; border-radius: 20px; font-size: 13px; white-space: nowrap; cursor: pointer; }
        .chip.active { background: #dc3545; color: white; border-color: #dc3545; }

        /* SHORTS VIEW */
        #shorts-view { height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; display: block; scroll-behavior: smooth; }
        .video-snap-item { height: 100%; width: 100%; scroll-snap-align: start; position: relative; background: #000; border-bottom: 1px solid #222; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .video-player { width: 100%; height: 100%; object-fit: contain; }
        .mute-btn { position: absolute; top: 20px; right: 20px; z-index: 100; background: rgba(0, 0, 0, 0.5); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); }
        .shorts-actions { position: absolute; bottom: 86px; right: 10px; display: flex; flex-direction: column; gap: 25px; align-items: center; z-index: 100; }
        .action-icon { font-size: 30px; cursor: pointer; }

        /* NEW: Styling for shorts actions - likes/views */
        .shorts-actions .action-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            font-size: 12px; /* For the count text */
            font-weight: bold;
        }
        .shorts-actions .action-item .action-icon {
            font-size: 26px; /* Slightly smaller than share icon */
            margin-bottom: 4px;
            cursor: default; /* Not clickable like share */
        }
        /* Keep share icon larger and clickable */
        .shorts-actions .share-button-container .action-icon {
            font-size: 30px;
            cursor: pointer;
        }

        /* CUSTOM VIDEO CONTROLS - FULLY UPDATED */
        .video-controls-container {
            position: absolute;
            bottom: 26px;
            left: 0;
            right: 0;
            height: 50px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 15px;
            /* background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent); */
        }

        /* Naye Buttons ki Styling */
        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            text-shadow: 0 0 5px black;
        }

        .seek-bar {
            flex-grow: 1;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            border-radius: 4px;
            position: relative;
        }

        .seek-progress {
            width: 0%;
            height: 100%;
            background-color: #dc3545;
            border-radius: 4px;
            position: relative;
        }

        /* Drag Handle (Dot) */
        .seek-progress::after {
            content: '';
            position: absolute;
            right: -6px;
            top: -4px;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(0,0,0,0.8);
        }

        /* Time Display Styling */
        .time-display {
            font-size: 12px;
            color: white;
            font-family: monospace;
            min-width: 90px;
            text-align: right;
            text-shadow: 1px 1px 2px black;
            font-weight: bold;
        }

        /* PICS & COMICS GRID */
        .grid-item { background-color: #222; border-radius: 8px; overflow: hidden; position: relative; }
        .grid-item img { width: 100%; height: 100%; object-fit: cover; }
        .grid-item .title { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 20px 8px 8px; font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .fake-stats-overlay {
            position: absolute;
            top: 8px;
            right: 8px;
            left: auto;
            display: flex;
            flex-direction: column; /* Stack stat items vertically */
            align-items: flex-end; /* Align each stat item to the right */
            background: none; /* Removed background */
            color: #fff;
            padding: 0; /* Removed padding */
            border-radius: 0; /* Removed border-radius */
            font-size: 11px;
            font-weight: bold;
            z-index: 5;
            gap: 8px; /* Increased gap between each stat item */
            backdrop-filter: none; /* Removed blur */
        }
        .fake-stats-overlay .stat-item {
            display: flex;
            flex-direction: column; /* Stack icon and number vertically */
            align-items: center; /* Center icon and number horizontally within item */
            gap: 2px; /* Gap between icon and number */
            background: rgba(0,0,0,0.5); /* Add semi-transparent background to each stat item */
            padding: 5px 8px;
            border-radius: 6px;
        }
        .fake-stats-overlay .stat-item i {
            font-size: 13px;
        }
        /* Make the share icon in overlay larger and clickable */
        .fake-stats-overlay .share-stat i.fas.fa-share {
            font-size: 18px; /* Make it a bit larger than others, but not too big */
            cursor: pointer;
        }

        .article-card .article-card-thumb {
            height: 166px;
            width: 36%;
            flex-shrink: 0;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            border-right: 1px solid #333;
            border-radius: 8px 0 0 8px;
        }
        .article-card {
            background-color: #1a1a1a;
            border-radius: 8px;
            height: auto;
            display: flex;
            flex-direction: row;
            border: 1px solid #333;
            overflow: hidden;
            align-items: flex-start;
        }
        .article-card .article-content-wrapper {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .article-card .title {
            font-size: 1rem;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }
        .article-card .snippet {
            font-size: 0.9rem;
            color: #ccc;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            flex-grow: 1;
        }

        /* BOTTOM NAV */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; background: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; align-items: center; z-index: 1001; }
                .nav-btn {
                    color: #666;
                    font-size: 10px;
                    text-align: center;
                    cursor: pointer;
                    width: 20%; /* Adjusted for 5 items */
                    text-decoration: none;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                }        .nav-btn.active { color: #dc3545; }
        .nav-btn i { font-size: 20px; margin-bottom: 4px; }

        /* HELPERS */
        .loader { text-align: center; padding-top: 5rem; color: #dc3545; }
        #debug-msg { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #333; padding: 20px; border-radius: 10px; border: 1px solid red; z-index: 9999; display: none; text-align: center; width: 80%; }

        /* VIDEO GRID LAYOUT - SINGLE COLUMN LIST */
        .video-grid {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Gap between list items */
            padding: 10px;
            background-color: #0f0f0f;
        }

        /* CARD DESIGN - ROW LAYOUT */
        .video-card {
            /* display: flex; */
            /* flex-direction: row; */
            gap: 15px;
            cursor: pointer;
            background: transparent;
            align-items: flex-start;
        }

        /* THUMBNAIL CONTAINER - FIXED WIDTH */
        .thumb-box {
            position: relative;
            width: 100%; /* Changed from fixed width */
            flex-shrink: 0;
            aspect-ratio: 16 / 9;
            border-radius: 8px;
            overflow: hidden;
            background: #222;
        }

        /* Ensure .video-info takes remaining space */
        .video-info {
             flex-grow: 1;
        }

        .thumb-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        /* OVERLAYS (4K Badge & Duration) */
        .badge-4k {
            position: absolute;
            top: 6px;
            right: 6px;
            background-color: #f7e600; /* Yellow Color */
            color: #000;
            font-weight: 700;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 3px;
            z-index: 2;
        }

        .duration-badge {
            position: absolute;
            bottom: 6px;
            right: 6px;
            background-color: rgba(0, 0, 0, 0.85); /* Black transparent */
            color: #fff;
            font-size: 11px;
            font-weight: 500;
            padding: 2px 5px;
            border-radius: 4px;
            z-index: 2;
        }

        /* TEXT INFO */
        .video-info {
            padding-top: 8px;
        }

        .video-title {
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            line-height: 1.2;
            margin-bottom: 4px;
            
            /* 2 Lines ke baad ... (ellipsis) */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .video-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #fff;
            font-size: 11px;
        }

        .video-meta i {
            margin-right: 4px;
        }

        /* Like Icon Blue Color */
        .fa-thumbs-up {
            color: #3ea6ff; 
        }

        /* SHORTS INFO OVERLAY */
        .shorts-info {
    /* font-size: 26px !important; */
    position: absolute;
    bottom: 96px;
    left: 15px;
    right: 80px;
    color: #fff;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
    z-index: 100;
}
.shorts-info .username {
    font-weight: bold;
    font-size: 1rem;
    /* margin-bottom: 8px; */
}
.shorts-info .hashtags {
    font-size: 0.9rem;
    /* font-weight: 500; */
    color: #faf9f9a3;
}
        #pics-view, #comics-view {
            padding: 0 10px; /* Remove top/bottom padding, keep side padding */
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0 15px;">
            <a class="brand-logo text-danger text-decoration-none m-0 p-0" href="index.html"><i class="fas fa-fire"></i> FreePornX</a>
            
            <div class="dropdown">
                <button class="btn btn-dark" type="button" id="menu-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end bg-dark" aria-labelledby="menu-toggle">
                    <li><a class="dropdown-item text-light" href="terms.html">Terms</a></li>
                    <li><a class="dropdown-item text-light" href="privacy.html">Privacy</a></li>
                    <li><a class="dropdown-item text-light" href="dmca.html">DMCA</a></li>
                    <li><a class="dropdown-item text-light" href="2257.html">2257 Compliance</a></li>
                    <li><a class="dropdown-item text-light" href="contact.html">Contact</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-light" href="faq.html">FAQ</a></li>
                </ul>
            </div>
        </div>
        <div class="category-scroll" id="categoryContainer"></div>
    </header>

    <div id="debug-msg"><h5 class="text-danger">Error</h5><p id="error-text"></p><button class="btn btn-sm btn-light" onclick="location.reload()">Retry</button></div>


    <div class="main-view">
        <div id="pull-to-refresh-indicator">
            <svg class="spinner" viewBox="0 0 50 50">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
        </div>
        <div id="shorts-view"></div>

<div id="shorts-seo-text" style="width: 1px; height: 1px; overflow: hidden; position: absolute; top: -1000px;">
    <h1>Free Porn xxx  videos Shorts & Viral Desi Reels</h1>
    <p>Welcome to the best collection of <strong>free porn xxx videos</strong>. We curate the best <strong>XXX TikTok style clips</strong> from around the web.</p>
    <h2>Trending Categories:</h2>
    <ul>
        <li><strong>Desi porn videos MMS Leaks:</strong> Real amateur free porn xxx videos from India and Pakistan.</li>
        <li><strong>Bhabhiporn videos  Reels:</strong> Hot saree free porn xxx lover shorts and free porn xxx homemade clips.</li>
        <li><strong>Viral Sex free porn xxx Tapes:</strong> Trending leaked free porn xxx videos from Instagram and Snapchat.</li>
    </ul>
</div>
        <div id="video-view" class="grid-view">
            <div id="video-grid" class="video-grid"></div>
            <div id="video-load-more-container" class="text-center p-3"></div>
        </div>
        <div id="pics-view" class="grid-view">
            <div class="row g-2" id="pics-grid"></div>
            <div id="pics-load-more-container" class="text-center p-3"></div>
        </div>
        <div id="comics-view" class="grid-view">
            <div class="row g-2" id="comics-grid"></div>
            <div id="comics-load-more-container" class="text-center p-3"></div>
        </div>
        <div id="desi-view" class="grid-view">
            <!-- Top Level Categories -->
            <div class="d-flex gap-2 mb-3" style="padding: 0 10px;">
                <button class="btn btn-danger flex-grow-1" id="btn-desi" onclick="switchDesiCategory('desi')">
                    Desi
                </button>
                <button class="btn btn-light flex-grow-1" id="btn-indian" onclick="switchDesiCategory('indian')">
                    Indian
                </button>
            </div>
            
            <div id="desi-grid" class="video-grid"></div>
            <div id="desi-load-more-container" class="text-center p-3"></div>
        </div>
        <div id="gifs-view" class="grid-view"><div id="gifs-container" style="display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 10px 0;"></div></div>
    </div>

    <div class="bottom-nav">
        <div class="nav-btn active" onclick="switchTab('shorts', this)"><i class="fas fa-play-circle"></i><span>Shorts</span></div>
        <div class="nav-btn" onclick="switchTab('video', this)"><i class="fas fa-video"></i><span>Video</span></div>
        <div class="nav-btn" onclick="switchTab('pics', this)"><i class="fas fa-images"></i><span>Pics</span></div>
        <div class="nav-btn" onclick="switchTab('comics', this)"><i class="fas fa-book-open"></i><span>Comics</span></div>
        <div class="nav-btn" onclick="switchTab('gifs', this)"><i class="fas fa-magic"></i><span>Gifs</span></div>
        <div class="nav-btn" onclick="switchTab('desi', this)"><i class="fas fa-fire"></i><span>Desi</span></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <script>
        const WORKER_URL = "https://redgif.aav5roy.workers.dev";
        const GIF_WORKER_URL = "https://gifandpicturefreex.freshhub95.workers.dev"; // New worker URL for GIFs
        const VIDEO_WORKER_URL = "https://sfwalbum.hikeapp-pvtltd.workers.dev";
        const DESI_WORKER_URL = "https://desitales-scraper.slayeranika.workers.dev";
        const firebaseConfig = {
            apiKey: "AIzaSyCQ3Ced4Ah2KaNlU6BFa5UfOTfFnXXjY2k",
            authDomain: "gallaryanika.firebaseapp.com",
            projectId: "gallaryanika",
            storageBucket: "gallaryanika.firebasestorage.app",
            messagingSenderId: "97730645039",
            appId: "1:97730645039:web:b215bc4482900bc1a30ada",
            measurementId: "G-M7S49TJP6X"
        };
        const generateSlug = (text) => {
            if (!text) return '';
            return text.toString().toLowerCase()
                .replace(/\.(jpg|jpeg|png|webp|gif)$/i, '')
                .normalize('NFD').replace(/[̀-ͯ]/g, '')
                .trim()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-');
        };
        let currentPage = 1;
        let videoCurrentPage = 1;
        let desiCurrentPage = 1;
        let currentDesiCategory = 'desi';
        let currentDesiFilter = 'new';
        let isVideoLoading = false;
        let currentFilter = 'new';
        let currentQuery = 'new';
        let currentTab = 'shorts';
        let isLoading = false;
        let isGlobalMuted = true;
        let db;
        let currentVideoPath = null; // New global variable to store custom video paths


        // --- NEW: Pagination state for Grids (Pics/Comics) ---
        let gridNextPageTokens = {}; // Stores nextPageToken for each folderId
        let currentGridFolderId = null;
        let currentGridType = null;


        // --- Pull To Refresh (PTR) Variables ---
        const ptr = {
            element: null,
            indicator: null,
            indicatorText: null,
            spinner: null,
            startY: 0,
            pulling: false,
            refreshing: false,
            threshold: 80 // How far to pull in pixels
        };

        // --- Pull To Refresh (PTR) Handlers ---
        function ptrOnTouchStart(e) {
            if (ptr.element.scrollTop === 0 && !ptr.refreshing) {
                ptr.pulling = true;
                ptr.startY = e.touches[0].clientY;
                ptr.indicator.style.transition = 'none';
            }
        }

        function ptrOnTouchMove(e) {
            if (!ptr.pulling || !ptr.indicator) return;

            const pullDistance = e.touches[0].clientY - ptr.startY;
            if (pullDistance > 0) {
                e.preventDefault();
                // We show the spinner rotating based on pull distance
                const rotation = Math.min(pullDistance * 2, 360);
                if(ptr.spinner) ptr.spinner.style.transform = `rotate(${rotation}deg)`;
                ptr.indicator.style.top = `${Math.min(pullDistance, ptr.threshold + 20) - 60}px`;
            }
        }

        async function ptrOnTouchEnd() {
            if (!ptr.pulling || !ptr.indicator) return;

            const pullDistance = parseFloat(ptr.indicator.style.top) + 60;
            ptr.indicator.style.transition = 'top 0.3s ease';
            if(ptr.spinner) ptr.spinner.style.transform = ''; // Reset transform

            if (pullDistance > ptr.threshold) {
                ptr.refreshing = true;
                ptr.indicator.style.top = '0px';
                if(ptr.spinner) ptr.spinner.style.display = 'block';
                
                await loadGifs(); // Await the refresh action

                ptr.indicator.style.top = '-60px';
                setTimeout(() => {
                    ptr.refreshing = false;
                    if(ptr.spinner) ptr.spinner.style.display = 'none';
                }, 300); // Wait for transition out
            } else {
                ptr.indicator.style.top = '-60px';
            }
            ptr.pulling = false;
        }

        function activatePullToRefresh() {
            if (!ptr.element) return;
            ptr.element.addEventListener('touchstart', ptrOnTouchStart);
            ptr.element.addEventListener('touchmove', ptrOnTouchMove, { passive: false });
            ptr.element.addEventListener('touchend', ptrOnTouchEnd);
        }

        function deactivatePullToRefresh() {
            if (!ptr.element) return;
            ptr.element.removeEventListener('touchstart', ptrOnTouchStart);
            ptr.element.removeEventListener('touchmove', ptrOnTouchMove);
            ptr.element.removeEventListener('touchend', ptrOnTouchEnd);
        }
        
        document.addEventListener("DOMContentLoaded", () => {
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
    // Pull-to-refresh init
    ptr.element = document.querySelector('.main-view');
    ptr.indicator = document.getElementById('pull-to-refresh-indicator');
    if (ptr.indicator) {
        ptr.spinner = ptr.indicator.querySelector('.spinner');
    }
    // URL Parameter Parsing
    const urlParams = new URLSearchParams(window.location.search);
    const shortId = urlParams.get('short');
    const tabParam = urlParams.get('tab');
    let pathParam = urlParams.get('path'); // Changed to let

    // If the path is a generic category, treat it as no path to show the default view
    if (pathParam === 'models' || pathParam === 'channels') {
        pathParam = null;
    }

    if (shortId) {
        loadSingleShort(shortId);
    } else {
        const validTabs = ['shorts', 'video', 'pics', 'comics', 'gifs', 'desi'];
        const initialTab = (tabParam && validTabs.includes(tabParam)) ? tabParam : 'shorts';
        const navButtons = Array.from(document.querySelectorAll('.nav-btn'));
        const initialBtn = navButtons.find(btn => btn.getAttribute('onclick').includes(`'${initialTab}'`)) || navButtons[0];
        
        switchTab(initialTab, initialBtn, pathParam);
    }
} catch (e) {
    showError("Startup Error: " + e.message);
}
});

        function updateMetaTag(selector, attribute, content) {
    const el = document.querySelector(selector);
    if (el) {
        el.setAttribute(attribute, content);
    }
}

function updateMetaForTab(tab, category = '') {
    // Clear any existing schema scripts
    const existingSchema = document.getElementById('schema-ld-json');
    if(existingSchema) existingSchema.remove();

    let title = "FreePornX | Free Porn Videos, free porn XXX Nude Photos,free porn xxx Savita & free porn xxx Velamma Comics PDF";
    let description = "free porn xxx Watch free viral porn videos, browse HD free porn xxx nude photos gallery, free porn xxx videos download full episodes of Savita Bhabhi & free porn xxx Velamma comics PDF, and free porn xxx read hot desi sex stories. Dailyfree porn xxx videos updates.";
    let keywords = "free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips";
    let canonicalUrl = "https://freepornx.site/";
    let schema = {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Free PornX Entertainment",
      "url": "https://freepornx.site/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://freepornx.site/?search={search_term_string}",
        "query-input": "required name=search_term_string"
      },
      "description": "Free platform for porn videos, adult comics, nude photos, and sex stories."
    };

    const baseUrl = window.location.origin + window.location.pathname;

    if (tab === 'shorts') {
        if (category) {
            const catTitle = category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            title = `Free ${catTitle} XXX Shorts - Watch ${catTitle} Porn Reels | FreePornX`;
            description = `Watch the best ${catTitle} free porn xxx sex shorts and free porn xxx sex viral XXX reels. New ${catTitle} free porn xxx sex clips added daily.`;
            keywords = `${catTitle} shorts, ${catTitle} free porn xxx sex reels,free porn xxx sex  porn shorts,free porn xxx sex xxx reels,free porn xxx sex viral shorts, free porn xxx sexdesi reels, free porn xxx sex mms leaks,free porn xxx sex indian bhabhi,free porn xxx sex tiktok sex, free porn xxx sex vertical porn, free porn xxx sex xxx shorts`;
            canonicalUrl = `${baseUrl}?tab=shorts&cat=${category}`;
        } else {
            title = "Free porn videos  XXX Shorts - free porn videos xxx sex Viral Desi Porn Reels, free porn videos xxx sex TikTok Sex &free porn videos xxx sex  MMS Leaks | FreePornX";
            description = "Watch unlimited free porn videos xxx sex shorts and free porn videos xxx sex porn videos. Daily update offree porn videos xxx sex viral Desi MMS leaks, free porn videos xxx sex Indian bhabhi reels, and free porn videos xxx sex hot TikTok style sex clips.";
            keywords = "free porn videos xxx sex viral shorts,free porn videos xxx sex desi reels, free porn videos xxx sex mms leaks, free porn videos xxx sex indian bhabhi, free porn videos xxx sex tiktok sex, free porn videos xxx sex vertical porn, free porn videos xxx sex xxx shorts";
            canonicalUrl = `${baseUrl}?tab=shorts`;
        }
        
        schema = {
          "@context": "https://schema.org",
          "@type": "CollectionPage",
          "name": title,
          "description": description,
          "url": canonicalUrl,
          "mainEntity": {
            "@type": "ItemList",
            "itemListElement": [
              { "@type": "ListItem", "position": 1, "url": `${baseUrl}?tab=shorts&cat=new` },
              { "@type": "ListItem", "position": 2, "url": `${baseUrl}?tab=shorts&cat=trending` }
            ]
          }
        };

    } else if (tab === 'video') {
        title = "free porn videos xxx sex & XXX Movies | FreePornX";
        description = " free porn videos xxx sex and free porn videos xxx sex full-length XXX movies in HD. Daily updates free porn videos xxx sex new categories and free porn videos xxx sex top-rated content.";
        keywords = " free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips free porn videos xxx sex ,free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips  free porn Desi Videos, free porn xxx sex , free porn movies, hd porn, free porn videos xxx sex desi sex video, free porn videos xxx sex indian web series";
        canonicalUrl = `${baseUrl}?tab=video`;
    } else if (tab === 'pics') {
        title = "free porn videos xxx sex Nude Photos & free porn videos xxx sex Adult Image Galleries | FreePornX";
        description = "free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips View high-quality free porn videos xxx sex nude photo galleries. free porn videos xxx sex Hot desi bhabhi pics, actress galleries, and more.";
        keywords = "free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips xxx photos, nude images, desi bhabhi pics, adult gallery, porn pictures";
        canonicalUrl = `${baseUrl}?tab=pics`;
    } else if (tab === 'comics') {
        title = "Free Adult Comics - Savita Bhabhi & Velamma PDF | FreePornX";
        description = "free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips Download full episodes of Savita Bhabhi & Velamma comics PDF for free. Read the best Indian adult comics online.";
        keywords = "free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips savita bhabhi pdf, velamma comics, free comics, adult comics, indian comics";
        canonicalUrl = `${baseUrl}?tab=comics`;
    } else if (tab === 'gifs') {
        title = "Hot Sex GIFs & Animated Porn Clips | FreePornX";
        description = "Watch the best collection of hot sex GIFs. Animated porn clips and short looping videos updated daily.";
        keywords = "free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips sex gifs, porn gifs, animated porn, hot gifs, xxx gifs";
        canonicalUrl = `${baseUrl}?tab=gifs`;
    } else if (tab === 'desi') {
        title = "Free pron xxx Desi Porn Videos & free porn xxx vidos Indian Sex Clips | FreePornX";
        description = "free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips Watch the latest hot Desi porn videos, Indian sex clips, and amateur MMS leaks. Updated daily with new Desi content.";
        keywords = "free porn videos xxx sex , free porn video desi, free porn xxx desi, desi porn videos,  free desi porn videos, free desi Bhabhi porn videos, free porn Indian sex videos, free India porn, videos, free porn viral desi videos, free viral desi porn videos, free porn videos xxx, free uncle aunty porn videos, free porn desi clips, free porn desi viral clips, free porn nude videos, porn xhamester, free porn xvideos, free xnxx porn videos, free porn stars videos , free porn viral clips, free porn videos Indian desi clips, free porn xxx sex videos, free porn videos, viral clips desi porn, indian sex, bhabhi videos, desi mms, indian porn videos, hindi sex";
        canonicalUrl = `${baseUrl}?tab=desi`;
    }

    // Update tags
    document.title = title;
    updateMetaTag('meta[name="description"]', "content", description);
    updateMetaTag('meta[name="keywords"]', "content", keywords);
    updateMetaTag('link[rel="canonical"]', "href", canonicalUrl);
    
    updateMetaTag('meta[property="og:title"]', "content", title);
    updateMetaTag('meta[property="og:description"]', "content", description);
    updateMetaTag('meta[property="og:url"]', "content", canonicalUrl);
    
    updateMetaTag('meta[name="twitter:title"]', "content", title);
    updateMetaTag('meta[name="twitter:description"]', "content", description);
    updateMetaTag('meta[name="twitter:url"]', "content", canonicalUrl);

    // Inject schema
    const script = document.createElement('script');
    script.id = 'schema-ld-json';
    script.type = 'application/ld+json';
    script.text = JSON.stringify(schema);
    document.head.appendChild(script);
}

        function switchTab(tab, btn, path = null) { // Added path parameter
    // --- NEW: Category Persistence Logic ---
    let lastCategoryName = null;
    if (currentTab === 'pics' || currentTab === 'comics') {
        const activeChip = document.querySelector('#categoryContainer .chip.active');
        if (activeChip) {
            lastCategoryName = activeChip.textContent.trim();
        }
    }
    // --- END NEW ---

    deactivatePullToRefresh();
    // SEO Friendly URL update: uses ?tab=value
    let newUrl = `${window.location.pathname}?tab=${tab}`;
    if (path) {
        newUrl += `&path=${encodeURIComponent(path)}`; // Add path to URL
    }
    window.history.pushState({ path: newUrl }, '', newUrl);
    currentTab = tab;
    updateMetaForTab(tab);

    // UI Updates
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    if (!btn) {
        const navButtons = Array.from(document.querySelectorAll('.nav-btn'));
        btn = navButtons.find(btn => btn.getAttribute('onclick').includes(`'${tab}'`));
    }
    if (btn) btn.classList.add('active');

    // View Switching
    document.querySelectorAll('.main-view > div[id$="-view"]').forEach(v => v.style.display = 'none');
    const activeView = document.getElementById(`${tab}-view`);
    if(activeView) activeView.style.display = 'block';

            // Content Loading Logic
        if (tab === 'shorts') {
            document.querySelector('.main-view').style.overflowY = 'hidden';
            fetchNichesAndRender(); // Always render the categories for shorts
    
            // --- NEW: Apply last category if it exists ---
            setTimeout(() => {
                if (lastCategoryName) {
                    const shortsCategories = Array.from(document.querySelectorAll('#categoryContainer .chip'));
                    // Find a matching or partially matching category
                    let targetCategory = shortsCategories.find(c => c.textContent.trim().toLowerCase() === lastCategoryName.toLowerCase());
                    
                    if (targetCategory) {
                        targetCategory.click(); // This will call handleShortsCatClick
                    }
                }
            }, 100); // A small delay to ensure categories are rendered
            // --- END NEW ---
    
        } else if (tab === 'video') {
            document.querySelector('.main-view').style.overflowY = 'auto';
            document.getElementById('categoryContainer').innerHTML = '';
            // NEW: Store current path
            currentVideoPath = path; // Global variable to hold the path
            videoCurrentPage = 1;
            loadVideos(); // Call loadVideos
        } else if (tab === 'desi') {
            document.querySelector('.main-view').style.overflowY = 'auto';
            document.getElementById('categoryContainer').innerHTML = '';
            desiCurrentPage = 1;
            loadDesiVideos();
        } else if (tab === 'gifs') {
            document.querySelector('.main-view').style.overflowY = 'auto';
            document.getElementById('categoryContainer').innerHTML = '';
            loadGifs();
            activatePullToRefresh();
        } else {
            document.querySelector('.main-view').style.overflowY = 'auto';
            fetchAndRenderDynamicCategories(tab);
        }
    }        
        function changeFilter(filterType, btnElement) {
            // 1. UI Update (Button Color)
            document.querySelectorAll('.filter-bar button').forEach(btn => {
                btn.classList.remove('btn-danger', 'active');
                btn.classList.add('btn-outline-light');
            });
            btnElement.classList.remove('btn-outline-light');
            btnElement.classList.add('btn-danger', 'active');

            // 2. Data Reset
            currentFilter = filterType;
            videoCurrentPage = 1;
            document.getElementById('video-grid').innerHTML = ''; // Clear existing videos
            document.getElementById('video-load-more-container').innerHTML = '';
            
            // 3. New Data Load
            loadVideos();
        }

        function renderCategories(list, type, isDynamic = false) {
            const box = document.getElementById('categoryContainer');
            box.innerHTML = '';
            list.forEach((item, i) => {
                const catName = isDynamic ? item.name : item;
                const folderId = isDynamic ? item.folderId : '';
                const isActive = i === 0 ? 'active' : '';
                const clickAction = isDynamic ? `handleGridCatClick('${folderId}', '${type}', this)` : `handleShortsCatClick('${catName}', this)`;
                box.innerHTML += `<span class="chip ${isActive}" onclick="${clickAction}">${catName}</span>`;
            });
            if (list.length > 0) {
                if (isDynamic) {
                    handleGridCatClick(list[0].folderId, type, document.querySelector('.chip.active'));
                } else {
                    handleShortsCatClick(list[0], document.querySelector('.chip.active'));
                }
            }
        }

                async function loadGifs() {
            if (isLoading) return;
            isLoading = true;
            const container = document.getElementById('gifs-container');
            // Only show the main loader if it's not a pull-to-refresh action
            if (ptr && !ptr.refreshing) {
                container.innerHTML = '<div class="loader"><div class="spinner-border"></div></div>';
            }

            try {
                // Fetch from the new GIF worker. Always page 1 as no load more.
                const fetchUrl = `${GIF_WORKER_URL}/feed?page=1`; // No limit, worker will send all it finds from page 1
                const res = await fetch(fetchUrl);
                if (!res.ok) throw new Error(`Worker responded with status: ${res.status}`);
                
                const data = await res.json();
                if (data.error) throw new Error(data.error);

                container.innerHTML = ''; // Clear loader/previous content

                const gifs = data.data || [];
                if (gifs.length > 0) {
                    gifs.forEach((gifUrl, index) => {
                        if (!gifUrl) return;

                        const gridItem = document.createElement('div');
                        gridItem.className = 'grid-item';
                        gridItem.style.width = '95%';
                        gridItem.style.maxWidth = '600px';
                        gridItem.style.margin = '0';

                        // NEW: Add fake stats overlay (similar to pics/comics)
                        const fakeStats = document.createElement('div');
                        fakeStats.className = 'fake-stats-overlay';
                        fakeStats.innerHTML = `
                            <span class="stat-item share-stat">
                                <i class="fas fa-share" id="share-icon-gif-${index}"></i> <!-- Unique ID for event listener -->
                                <span class="action-count">${formatNumber(Math.floor(Math.random() * 900000) + 10000)}</span>
                            </span>
                            <span class="stat-item">
                                <i class="fas fa-eye"></i>
                                <span class="action-count">${formatNumber(Math.floor(Math.random() * 50000000) + 5000000)}</span>
                            </span>
                            <span class="stat-item">
                                <i class="fas fa-heart"></i>
                                <span class="action-count">${formatNumber(Math.floor(Math.random() * 4900000) + 100000)}</span>
                            </span>
                        `;
                        gridItem.appendChild(fakeStats);

                        const isVideo = gifUrl.match(/\.(mp4|webm)$/i);
                        const element = document.createElement(isVideo ? 'video' : 'img');
                        element.style.objectFit = 'contain';
                        element.style.height = 'auto';
                        element.style.width = '100%';

                        const proxiedUrl = `${GIF_WORKER_URL}/proxy?url=${encodeURIComponent(gifUrl)}`;
                        if (isVideo) {
                            element.setAttribute('playsinline', '');
                            element.setAttribute('autoplay', '');
                            element.setAttribute('loop', '');
                            element.setAttribute('muted', '');
                            element.src = proxiedUrl;
                        } else {
                            element.src = proxiedUrl;
                            element.loading = 'lazy';
                        }
                        element.onerror = () => {
                            console.error("Error loading media:", proxiedUrl);
                            gridItem.innerHTML = `<div class="alert alert-danger">Error loading: ${gifUrl}</div>`;
                        };
                        
                        const title = document.createElement('div');
                        title.className = 'title';
                        title.textContent = "Freepornx GIF";
                        
                        gridItem.appendChild(element);
                        gridItem.appendChild(title);
                        // Original shareIcon creation removed.
                        container.appendChild(gridItem);

                        // Add event listener for the new share icon in the overlay
                        const newShareIcon = gridItem.querySelector(`#share-icon-gif-${index}`);
                        if (newShareIcon) {
                            newShareIcon.addEventListener('click', event => shareGif(event, gifUrl));
                        }

                        if ((index + 1) % 2 === 0) {
                            const adCol = document.createElement('div');
                            adCol.className = 'grid-item ad-item'; // Use grid-item ad-item for gifs to match its styling
                            adCol.style.width = '95%';
                            adCol.style.maxWidth = '600px';
                            adCol.style.padding = '20px 0';
                            adCol.style.background = '#111';
                            adCol.style.textAlign = 'center';
                            
                            const adHeading = document.createElement('h6');
                            adHeading.className = 'text-muted mb-2';
                            adHeading.style.fontSize = '10px';
                            adHeading.textContent = 'Advertisement';
                            adCol.appendChild(adHeading);

                            const adScript1 = document.createElement('script');
                            adScript1.async = true;
                            adScript1.type = 'application/javascript';
                            adScript1.src = 'https://a.magsrv.com/ad-provider.js';
                            adCol.appendChild(adScript1);

                            const adIns = document.createElement('ins');
                            adIns.className = 'eas6a97888e10';
                            adIns.dataset.zoneid = '5792418'; // Correct zone ID
                            adCol.appendChild(adIns);

                            const adScript2 = document.createElement('script');
                            adScript2.type = 'application/javascript';
                            adScript2.textContent = '(AdProvider = window.AdProvider || []).push({"serve": {}});';
                            adCol.appendChild(adScript2);

                            container.appendChild(adCol); // Append to main container, not grid
                        }
                    });
                } else {
                    container.innerHTML = '<div class="text-center pt-5 text-warning">No GIFs found.</div>';
                }

            } catch (err) {
                console.error("Error in loadGifs function:", err);
                showError(`Failed to load GIFs: ${err.message}`);
                container.innerHTML = `<div class="alert alert-danger m-3">Failed to load GIFs. Please pull to refresh.</div>`;
            }
            isLoading = false;
        }


        function generateRandomDuration() {
            const minutes = Math.floor(Math.random() * 26) + 5; // 5 to 30 minutes
            const seconds = Math.floor(Math.random() * 60);
            const formattedMinutes = String(minutes).padStart(2, '0');
            const formattedSeconds = String(seconds).padStart(2, '0');
            return `${formattedMinutes}:${formattedSeconds}`;
        }

        const formatNumber = (num) => {
            const numericValue = parseInt(String(num).replace(/,/g, ''));
            if (isNaN(numericValue)) return num;

            if (numericValue >= 1000000) { // Millions
                return (numericValue / 1000000).toFixed(1) + 'M';
            }
            if (numericValue >= 100000) { // Lakhs (100,000)
                return (numericValue / 100000).toFixed(1) + 'L';
            }
            if (numericValue >= 1000) { // Thousands
                return (numericValue / 1000).toFixed(1) + 'K';
            }
            return numericValue.toString();
        };

        async function loadVideos(isLoadMore = false) {
            if (isVideoLoading) return;
            isVideoLoading = true;

            const container = document.getElementById('video-grid');
            const loadMoreContainer = document.getElementById('video-load-more-container');

            if (!isLoadMore) {
                container.innerHTML = '<div class="loader"><div class="spinner-border"></div></div>';
                loadMoreContainer.innerHTML = '';
            } else {
                const loadMoreBtn = document.getElementById('video-load-more-btn');
                if(loadMoreBtn) loadMoreBtn.disabled = true;
            }

            try {
                let fetchUrl;
                if (currentVideoPath) {
                    // Use path for models/channels
                    fetchUrl = `${VIDEO_WORKER_URL}/feed?page=${videoCurrentPage}&path=${encodeURIComponent(currentVideoPath)}`;
                } else {
                    // Use category for default filtering (new, popular, top)
                    fetchUrl = `${VIDEO_WORKER_URL}/feed?page=${videoCurrentPage}&cat=${currentFilter}`;
                }
                
                const res = await fetch(fetchUrl);
                
                // BETTER ERROR HANDLING HERE
                if (!res.ok) {
                    if (res.status === 404) throw new Error("Video feed not found (404). Check API URL.");
                    throw new Error(`Server Error: ${res.status}`);
                }

                const json = await res.json();
                if (json.error) throw new Error(json.error);

                if (!isLoadMore) {
                    container.innerHTML = '';
                }

                const videos = json.data || [];
                if (videos.length > 0) {
                    videos.forEach((item, index) => { // Added index
                        const div = document.createElement('div');
                        div.className = 'video-card';
                        
                        div.onclick = () => {
                            const urlParts = item.video_page_url.split('/');
                            const videoSlug = urlParts[urlParts.length - 2];
                            window.location.href = `video-viewer.html?view=${videoSlug}`;
                        };

                        div.innerHTML = `
                            <div class="thumb-box">
                                <img src="${item.thumbnail}" loading="lazy" alt="thumb">
                            </div>
                            <div class="video-info">
                                <div class="video-title">${item.title}</div>
                            </div>
                        `;
                        container.appendChild(div);

                        // Inject an ad every 2 videos (if not the last video)
                        if ((index + 1) % 2 === 0 && (index + 1) < videos.length) { // Change to every 2 items
                            const adContainer = document.createElement('div');
                            adContainer.className = 'video-card ad-item'; // Use same class for grid layout
                            adContainer.style.padding = '20px 0';
                            adContainer.style.background = '#111';
                            adContainer.style.textAlign = 'center';

                            const adHeading = document.createElement('h6');
                            adHeading.className = 'text-muted mb-2';
                            adHeading.style.fontSize = '10px';
                            adHeading.textContent = 'Advertisement';
                            adContainer.appendChild(adHeading);

                            const adScript1 = document.createElement('script');
                            adScript1.async = true;
                            adScript1.type = 'application/javascript';
                            adScript1.src = 'https://a.magsrv.com/ad-provider.js';
                            adContainer.appendChild(adScript1);

                            const adIns = document.createElement('ins');
                            adIns.className = 'eas6a97888e10';
                            adIns.dataset.zoneid = '5792418'; // Correct zone ID
                            adContainer.appendChild(adIns);

                            const adScript2 = document.createElement('script');
                            adScript2.type = 'application/javascript';
                            adScript2.textContent = '(AdProvider = window.AdProvider || []).push({"serve": {}});';
                            adContainer.appendChild(adScript2);

                            container.appendChild(adContainer);
                        }
                    });
                    // Refresh ads after adding them
                    try {
                        (window.AdProvider = window.AdProvider || []).push({"serve": {}});
                    } catch (e) {
                        console.error("Ad serving error:", e);
                    }
                    // Re-add load more button logic
                    loadMoreContainer.innerHTML = `<button id="video-load-more-btn" class="btn btn-danger" onclick="loadMoreVideos()">Load More</button>`;
                    videoCurrentPage++;
                } else {
                    if (!isLoadMore) {
                        container.innerHTML = '<div class="text-center pt-5 text-warning">No videos found.</div>';
                        loadMoreContainer.innerHTML = '';
                    } else {
                        loadMoreContainer.innerHTML = '<div class="text-center text-muted p-3">No more videos to load.</div>';
                    }
                }

            } catch (err) {
                console.error("Error in loadVideos function:", err);
                // Display a user-friendly error on the screen
                if (!isLoadMore) {
                    container.innerHTML = `<div class="alert alert-danger m-3">Unable to load videos. Server is currently unavailable.</div>`;
                }
            }
            isVideoLoading = false;
        }

        function loadMoreVideos() {
            loadVideos(true);
        }

        function initializeCustomPlayer(videoItem) {
            const video = videoItem.querySelector('.video-player');
            const seekBar = videoItem.querySelector('.seek-bar');
            const seekProgress = videoItem.querySelector('.seek-progress');
            const playBtnIcon = videoItem.querySelector('.play-pause-btn i');
            const playBtn = videoItem.querySelector('.play-pause-btn');
            const muteBtnIcon = videoItem.querySelector('.mute-toggle i');
            const muteBtn = videoItem.querySelector('.mute-toggle');
            const timeDisplay = videoItem.querySelector('.time-display');
            if (!video || !seekBar) return;
            muteBtnIcon.className = isGlobalMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
            video.muted = isGlobalMuted;
            const formatTime = (seconds) => {
                if (isNaN(seconds)) return "00:00";
                const m = Math.floor(seconds / 60);
                const s = Math.floor(seconds % 60);
                return `${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`;
            };
            const togglePlay = (e) => {
                if(e) e.stopPropagation();
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            };
            video.addEventListener('click', togglePlay);
            playBtn.addEventListener('click', togglePlay);
            muteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                isGlobalMuted = !isGlobalMuted;
                video.muted = isGlobalMuted;
                muteBtnIcon.className = isGlobalMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
            });
            video.addEventListener('timeupdate', () => {
                if (video.duration) {
                    const progress = (video.currentTime / video.duration) * 100;
                    seekProgress.style.width = `${progress}%`;
                    timeDisplay.innerText = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
                }
            });
            seekBar.addEventListener('click', (e) => {
                e.stopPropagation();
                if (video.duration) {
                    const rect = seekBar.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;
                    const width = rect.width;
                    video.currentTime = (clickX / width) * video.duration;
                }
            });
            video.addEventListener('play', () => playBtnIcon.className = 'fas fa-pause');
            video.addEventListener('pause', () => playBtnIcon.className = 'fas fa-play');
        }

        const shortsObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const video = entry.target.querySelector('video');
                if (!video) return;
                if (entry.isIntersecting) {
                    video.muted = isGlobalMuted;
                    const muteBtnIcon = entry.target.querySelector('.mute-toggle i');
                    if (muteBtnIcon) {
                        muteBtnIcon.className = isGlobalMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
                    }
                    if (!video.getAttribute('src')) {
                        video.src = video.dataset.src;
                        video.load();
                    }
                    video.play().catch(err => {});
                } else {
                    video.pause();
                }
            });
        }, { threshold: 0.6 });
        
        async function fetchNichesAndRender() {
            renderCategories(["New", "Trending", "Desi", "Hardcore", "Ass", "Asian", "Latina", "MILF", "Amateur"], 'shorts');
        }

        function handleShortsCatClick(cat, btn, skipHistory = false) {
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            if (btn) btn.classList.add('active');

            let query = cat === 'Trending' ? 'trending' : (cat === 'New' ? 'new' : `niche:${cat.toLowerCase()}`);

            if (!skipHistory) {
                const catSlug = cat.toLowerCase().replace(/ /g, '-');
                const newUrl = `${window.location.pathname}?tab=shorts&cat=${catSlug}`;
                window.history.pushState({ path: newUrl }, '', newUrl);
            }
    
            updateMetaForTab('shorts', cat);

            loadShorts(query, true);
        }

        async function loadShorts(query, isNewCategory = false) {
            if (isLoading) return;
            isLoading = true;
            const container = document.getElementById('shorts-view');
            let loadBtn = null;
            if (isNewCategory) {
                shortsObserver.disconnect();
                currentPage = Math.floor(Math.random() * 20) + 1;
                currentQuery = query;
                container.innerHTML = '<div class="loader"><div class="spinner-border"></div></div>';
            } else {
                loadBtn = document.getElementById('load-more-btn');
                if (loadBtn) {
                    loadBtn.textContent = "Loading...";
                    loadBtn.disabled = true;
                }
            }

            try {
                const res = await fetch(`${WORKER_URL}/redgifs/feed/${query}?page=${currentPage}`);
                const data = await res.json();
                if (data.error) throw new Error(data.message || "API Error");
                if (isNewCategory) {
                    container.innerHTML = '';
                    
                    // // Add static ad banner at the top for new categories
                    // const staticAdItem = document.createElement('div');
                    // staticAdItem.className = 'video-snap-item';
                    // staticAdItem.innerHTML = `
                    //     <div style="display:flex; align-items:center; justify-content:center; width:100%; height:100%; background:#000; flex-direction:column;">
                    //         <h6 class="text-muted mb-3">Advertisement</h6>
                    //         <div>
                    //             <ins class="eas6a97888e10" data-zoneid="5792430"></ins> 
                    //         </div>
                    //     </div>
                    // `;
                    // container.appendChild(staticAdItem);
                    // (window.AdProvider = window.AdProvider || []).push({"serve": {}});
                    // shortsObserver.observe(staticAdItem);

                } else {
                    const loadBtnContainer = container.querySelector('.load-more-container');
                    if(loadBtnContainer) loadBtnContainer.remove();
                }

                const videos = data.gifs || [];
                if (videos.length === 0) {
                     if (isNewCategory) {
                        // Don't clear the ad, just add the message
                        container.innerHTML += '<div class="text-center pt-5 text-warning">No videos found.</div>';
                     }
                     isLoading = false; 
                     return;
                }
                
                videos.forEach((video, index) => {
                    const originalUrl = video.urls?.sd || video.urls?.hd;
                    if (!originalUrl) return;
                    const videoSrc = `${WORKER_URL}/proxy/video?url=${encodeURIComponent(originalUrl)}`;
                    const item = document.createElement('div');
                    item.className = 'video-snap-item';
                    const mutedAttribute = isGlobalMuted ? 'muted' : '';
                    const tagsHTML = (video.tags && video.tags.length > 0) 
                        ? `<div class="hashtags">${video.tags.map(tag => `#${tag}`).join(' ')}</div>` 
                        : '';

                    item.innerHTML = `
                        <video class="video-player" data-src="${videoSrc}" poster="${video.urls?.poster}" ${mutedAttribute} loop playsinline preload="metadata"></video>
                        
                        <div class="shorts-info">
                            <div class="username">@${video.userName || 'unknown_user'}</div>
                            ${tagsHTML}
                        </div>

                        <div class="shorts-actions">
                            <!-- Share button with count -->
                            <div class="action-item share-button-container">
                                <i class="fas fa-share action-icon share-short-btn" data-video-id="${video.id}" data-user-name="${video.userName || ''}"></i>
                                <span class="action-count">${formatNumber(Math.floor(Math.random() * 900000) + 10000)}</span>
                            </div>
                            <!-- Fake Likes -->
                            <div class="action-item">
                                <i class="fas fa-heart action-icon"></i>
                                <span class="action-count">${formatNumber(Math.floor(Math.random() * 4900000) + 100000)}</span>
                            </div>
                            <!-- Fake Views -->
                            <div class="action-item">
                                <i class="fas fa-eye action-icon"></i>
                                <span class="action-count">${formatNumber(Math.floor(Math.random() * 50000000) + 5000000)}</span>
                            </div>
                        </div>
                        <div class="video-controls-container">
                            <button class="control-btn play-pause-btn"><i class="fas fa-play"></i></button>
                            <div class="seek-bar"><div class="seek-progress"></div></div>
                            <span class="time-display">00:00 / 00:00</span>
                            <button class="control-btn mute-toggle"><i class="fas fa-volume-mute"></i></button>
                        </div>
                    `;
                    container.appendChild(item);
                    initializeCustomPlayer(item);
                    shortsObserver.observe(item);
                    if ((index + 1) % 2 === 0) {
                        const adItem = document.createElement('div');
                        adItem.className = 'video-snap-item';
                        adItem.innerHTML = `
                            <div style="display:flex; align-items:center; justify-content:center; width:100%; height:100%; background:#000; flex-direction:column;">
                                <h6 class="text-muted mb-3">Advertisement</h6>
                                <div>
                                    
                                <ins class="eas6a97888e10" data-zoneid="5792430"></ins> 
                                </div>
                            </div>
                        `;
                        container.appendChild(adItem);
                        (window.AdProvider = window.AdProvider || []).push({"serve": {}});
                        shortsObserver.observe(adItem); // Observe dynamic ad item
                    }
                });
                
                addShareListeners(container);
                container.insertAdjacentHTML('beforeend', `<div class="load-more-container" style="height: 120px; display:flex; align-items:center; justify-content:center; scroll-snap-align: start;"><button id="load-more-btn" class="btn btn-danger" onclick="nextShortsPage()">Load More</button></div>`);

            } catch (err) { 
                showError(err.message);
                if (loadBtn) {
                    loadBtn.textContent = "Load More";
                    loadBtn.disabled = false;
                }
            }
            isLoading = false;
        }

        function nextShortsPage() {
            currentPage++;
            loadShorts(currentQuery, false);
        }

        async function fetchAndRenderDynamicCategories(type) {
            const gridId = `${type}-grid`;
            document.getElementById(gridId).innerHTML = '<div class="loader"><div class="spinner-border"></div></div>';
            
            try {
                const docRef = db.collection("navLinks").doc("main-menu");
                const doc = await docRef.get();
                if (!doc.exists) throw new Error("navLinks document not found in Firestore.");
                
                const allLinks = doc.data().links || [];
                const targetType = type === 'pics' ? 'gallery' : 'pdf';
                
                let categories = [];
                allLinks.forEach(link => {
                    if (link.type === targetType) categories.push(link);
                    if (link.children) {
                        link.children.forEach(child => {
                            if (child.type === targetType) categories.push(child);
                        });
                    }
                });
                
                if (categories.length === 0) {
                    document.getElementById('categoryContainer').innerHTML = '';
                    document.getElementById(gridId).innerHTML = `<div class="text-center pt-5 text-warning">No ${type} categories found in admin.</div>`;
                } else {
                    renderCategories(categories, type, true);
                }
            } catch (err) { showError(`Error fetching ${type} categories: ${err.message}`); }
        }

        function handleGridCatClick(folderId, type, btn) {
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');

            // Set current context for 'Load More' button
            currentGridFolderId = folderId;
            currentGridType = type;
            
            // Call the main loading function, ensuring it's not a 'load more' action
            loadGridContent(folderId, type, false);
        }

        async function loadGridContent(folderId, type, isLoadMore = false) {
            if (isLoading) return;
            isLoading = true;

            const grid = document.getElementById(`${type}-grid`);
            const loadMoreContainer = document.getElementById(`${type}-load-more-container`);
            const loadMoreBtn = document.getElementById(`${type}-load-more-btn`);

            let pageToken = isLoadMore ? (gridNextPageTokens[folderId] || null) : null;

            if (isLoadMore) {
                if (loadMoreBtn) {
                    loadMoreBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Loading...';
                    loadMoreBtn.disabled = true;
                }
            } else {
                grid.innerHTML = '<div class="loader"><div class="spinner-border"></div></div>';
                loadMoreContainer.innerHTML = ''; // Clear previous button
            }

            try {
                let fetchUrl = `${WORKER_URL}/gdrive/list?folderId=${folderId}`;
                if (pageToken) {
                    fetchUrl += `&pageToken=${pageToken}`;
                }

                const res = await fetch(fetchUrl);
                const data = await res.json();
                
                if (data.error) throw new Error(data.message);

                const files = data.files || [];
                const newNextPageToken = data.nextPageToken || null;

                if (!isLoadMore) {
                    grid.innerHTML = ''; // Clear loader
                }

                if (files.length === 0 && !isLoadMore) {
                    grid.innerHTML = '<div class="text-center pt-5 text-warning">No items found in this category.</div>';
                    isLoading = false;
                    return;
                }

                // Store the token for the next load
                gridNextPageTokens[folderId] = newNextPageToken;

                // --- NEW LOGIC HERE: Manage a persistent list for sessionStorage ---
                let currentPersistentList = [];
                if (sessionStorage.getItem('gallery-' + folderId)) {
                    currentPersistentList = JSON.parse(sessionStorage.getItem('gallery-' + folderId));
                }
                
                if (!isLoadMore) {
                    currentPersistentList = []; // Reset for new category or initial load
                }
                currentPersistentList = currentPersistentList.concat(files);
                sessionStorage.setItem('gallery-' + folderId, JSON.stringify(currentPersistentList));
                // --- END NEW LOGIC ---

                // --- RENDER ITEMS ---
                files.forEach((file, index) => {
                    const isPdf = file.mimeType === 'application/pdf';
                    const col = document.createElement('div');
                    col.className = 'col-6 col-md-4 col-lg-3';
                    const gridItem = document.createElement('div');
                    gridItem.className = 'grid-item';
                    
                    // NEW: Add fake stats overlay
                    const fakeStats = document.createElement('div');
                    fakeStats.className = 'fake-stats-overlay';
                    fakeStats.innerHTML = `
                        <span class="stat-item share-stat">
                            <i class="fas fa-share" id="share-icon-${file.id}"></i> <!-- Add ID for event listener -->
                            <span class="action-count">${formatNumber(Math.floor(Math.random() * 900000) + 10000)}</span>
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-eye"></i>
                            <span class="action-count">${formatNumber(Math.floor(Math.random() * 50000000) + 5000000)}</span>
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-heart"></i>
                            <span class="action-count">${formatNumber(Math.floor(Math.random() * 4900000) + 100000)}</span>
                        </span>
                    `;
                    gridItem.appendChild(fakeStats); // Append before link so it's above

                    const link = document.createElement('a');
                    link.className = 'text-decoration-none';
                    link.style.display = 'block';
                    link.style.width = '100%';
                    link.style.height = '100%';
                    
                    if (isPdf) {
                        const slug = generateSlug(file.name);
                        link.href = `pdf-viewer.html?read=${slug}&id=${file.id}`;
                    } else {
                        let cleanName = file.name.replace(/\.[^/.]+$/, "");
                        const slug = generateSlug(cleanName); 
                        link.href = `image-viewer.html?view=${slug}&id=${file.id}&folder=${folderId}`;
                    }

                    const img = document.createElement('img');
                    if (isPdf) {
                        let thumbnailUrl = 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/PDF_file_icon.svg/800px-PDF_file_icon.svg.png';
                        if (file.thumbnailLink) {
                            thumbnailUrl = `${WORKER_URL}/proxy/image?url=${encodeURIComponent(file.thumbnailLink)}`;
                        }
                        img.src = thumbnailUrl;
                    } else {
                        img.src = `${WORKER_URL}/gdrive/file/${file.id}`;
                        img.loading = 'lazy';
                    }
                    img.alt = file.name;

                    const title = document.createElement('div');
                    title.className = 'title';
                    title.textContent = file.name;
                    
                    link.appendChild(img);
                    link.appendChild(title);
                    gridItem.appendChild(link);

                    col.appendChild(gridItem);
                    grid.appendChild(col);
                    
                    // Event listener added after appending gridItem to the DOM
                    const newShareIcon = gridItem.querySelector(`#share-icon-${file.id}`);
                    if (newShareIcon) {
                        newShareIcon.addEventListener('click', event => shareGridItem(event, file.id, file.name, isPdf));
                    }

                    // NEW: Insert ad after every two items (if not the last item)
                    if ((index + 1) % 2 === 0 && (index + 1) < files.length) {
                        const adCol = document.createElement('div');
                        adCol.className = 'col-12 ad-item-wrapper'; // Full width for ad
                        
                        const adContainerDiv = document.createElement('div');
                        adContainerDiv.style.cssText = "text-align: center; padding: 10px 0; background-color: #111; margin-bottom: 15px;";

                        const adHeading = document.createElement('h6');
                        adHeading.className = 'text-muted mb-2';
                        adHeading.style.fontSize = '10px';
                        adHeading.textContent = 'Advertisement';
                        adContainerDiv.appendChild(adHeading);

                        const adScript1 = document.createElement('script');
                        adScript1.async = true;
                        adScript1.type = 'application/javascript';
                        adScript1.src = 'https://a.magsrv.com/ad-provider.js';
                        adContainerDiv.appendChild(adScript1);

                        const adIns = document.createElement('ins');
                        adIns.className = 'eas6a97888e10';
                        adIns.dataset.zoneid = '5792418';
                        adContainerDiv.appendChild(adIns);

                        const adScript2 = document.createElement('script');
                        adScript2.type = 'application/javascript';
                        adScript2.textContent = '(AdProvider = window.AdProvider || []).push({"serve": {}});';
                        adContainerDiv.appendChild(adScript2);

                        adCol.appendChild(adContainerDiv);
                        grid.appendChild(adCol);
                    }
                });
                // --- END RENDER ---

                // --- MANAGE LOAD MORE BUTTON ---
                loadMoreContainer.innerHTML = ''; // Clear previous button or loader
                if (newNextPageToken) {
                    loadMoreContainer.innerHTML = `<button id="${type}-load-more-btn" class="btn btn-danger" onclick="loadMoreCurrentGrid()">Load More</button>`;
                } else {
                    if (isLoadMore) {
                         loadMoreContainer.innerHTML = '<div class="text-center text-muted p-3">No more items to load.</div>';
                    }
                }

            } catch (err) {
                showError(`Failed to load ${type}: ${err.message}`);
                if (isLoadMore && loadMoreBtn) {
                     loadMoreBtn.innerText = 'Retry';
                     loadMoreBtn.disabled = false;
                }
            }
            isLoading = false;
        }

        function loadMoreCurrentGrid() {
            if (currentGridFolderId && currentGridType) {
                loadGridContent(currentGridFolderId, currentGridType, true);
            }
        }

        function switchDesiCategory(category) {
            currentDesiCategory = category;
            desiCurrentPage = 1; // Page reset karo

            // UI Update (Buttons ka color change)
            if (category === 'desi') {
                document.getElementById('btn-desi').className = 'btn btn-danger flex-grow-1';
                document.getElementById('btn-indian').className = 'btn btn-light flex-grow-1';
            } else {
                document.getElementById('btn-desi').className = 'btn btn-light flex-grow-1';
                document.getElementById('btn-indian').className = 'btn btn-danger flex-grow-1';
            }

            // Naya data load karo
            loadDesiVideos();
        }

        function changeDesiFilter(filt, btn) {
            if(currentDesiFilter === filt) return;
            currentDesiFilter = filt;
            desiCurrentPage = 1;

            // UI Update
            document.querySelectorAll('.desi-filter-bar .btn').forEach(b => {
                b.classList.remove('btn-secondary', 'active');
                b.classList.add('btn-outline-light');
            });
            btn.classList.remove('btn-outline-light');
            btn.classList.add('btn-secondary', 'active');

            loadDesiVideos();
        }

        async function loadDesiVideos(isLoadMore = false) {
            if (isVideoLoading) return;
            isVideoLoading = true;

            const container = document.getElementById('desi-grid');
            const loadMoreContainer = document.getElementById('desi-load-more-container');

            if (!isLoadMore) {
                container.innerHTML = '<div class="loader"><div class="spinner-border"></div></div>';
                loadMoreContainer.innerHTML = '';
            } else {
                const loadMoreBtn = document.getElementById('desi-load-more-btn');
                if(loadMoreBtn) loadMoreBtn.disabled = true;
            }

            try {
                // Restore queryTerm logic as fallback/hint for backend
                const queryTerm = currentDesiCategory === 'desi' ? 'indian desi' : 'indian';
                
                // ✅ API Call mein 'category' aur 'q' dono bhej rahe hain safety ke liye
                const fetchUrl = `${DESI_WORKER_URL}/desi-feed?page=${desiCurrentPage}&filter=${currentDesiFilter}&category=${currentDesiCategory}&q=${encodeURIComponent(queryTerm)}`;
                
                const res = await fetch(fetchUrl);
                
                if (!res.ok) {
                    if (res.status === 404) throw new Error("Video feed not found (404). Check API URL.");
                    throw new Error(`Server Error: ${res.status}`);
                }

                const json = await res.json();
                if (json.error) throw new Error(json.error);

                if (!isLoadMore) {
                    container.innerHTML = '';
                }

                const videos = json.data || [];
                if (videos.length > 0) {
                    videos.forEach((item, index) => { 
                        const div = document.createElement('div');
                        div.className = 'video-card';
                        
                        // Navigate to desiporn.html with a clean path
                        div.onclick = () => {
                            const cleanPath = item.video_page_url.replace('https://spankbang.com/', '');
                            window.location.href = `desiporn.html?v=${encodeURIComponent(cleanPath)}`;
                        };

                        div.innerHTML = `
                            <div class="thumb-box">
                                <img src="${DESI_WORKER_URL}/proxy?url=${encodeURIComponent(item.thumbnail)}" loading="lazy" alt="thumb">
                            </div>
                            <div class="video-info">
                                <div class="video-title">${item.title}</div>
                            </div>
                        `;
                        container.appendChild(div);

                        // Inject an ad every 2 videos
                        if ((index + 1) % 2 === 0 && (index + 1) < videos.length) { 
                            const adContainer = document.createElement('div');
                            adContainer.className = 'video-card ad-item';
                            adContainer.style.padding = '20px 0';
                            adContainer.style.background = '#111';
                            adContainer.style.textAlign = 'center';

                            const adHeading = document.createElement('h6');
                            adHeading.className = 'text-muted mb-2';
                            adHeading.style.fontSize = '10px';
                            adHeading.textContent = 'Advertisement';
                            adContainer.appendChild(adHeading);

                            const adScript1 = document.createElement('script');
                            adScript1.async = true;
                            adScript1.type = 'application/javascript';
                            adScript1.src = 'https://a.magsrv.com/ad-provider.js';
                            adContainer.appendChild(adScript1);

                            const adIns = document.createElement('ins');
                            adIns.className = 'eas6a97888e10';
                            adIns.dataset.zoneid = '5792418'; // Correct zone ID
                            adContainer.appendChild(adIns);

                            const adScript2 = document.createElement('script');
                            adScript2.type = 'application/javascript';
                            adScript2.textContent = '(AdProvider = window.AdProvider || []).push({"serve": {}});';
                            adContainer.appendChild(adScript2);

                            container.appendChild(adContainer);
                        }
                    });
                    
                    try {
                        (window.AdProvider = window.AdProvider || []).push({"serve": {}});
                    } catch (e) {
                        console.error("Ad serving error:", e);
                    }
                    
                    loadMoreContainer.innerHTML = `<button id="desi-load-more-btn" class="btn btn-danger" onclick="loadMoreDesiVideos()">Load More</button>`;
                    desiCurrentPage++;
                } else {
                    if (!isLoadMore) {
                        container.innerHTML = '<div class="text-center pt-5 text-warning">No videos found.</div>';
                        loadMoreContainer.innerHTML = '';
                    } else {
                        loadMoreContainer.innerHTML = '<div class="text-center text-muted p-3">No more videos to load.</div>';
                    }
                }

            } catch (err) {
                console.error("Error in loadDesiVideos function:", err);
                if (!isLoadMore) {
                    container.innerHTML = `<div class="alert alert-danger m-3">Unable to load videos. Server is currently unavailable.</div>`;
                }
            }
            isVideoLoading = false;
        }

        function loadMoreDesiVideos() {
            loadDesiVideos(true);
        }

        function addShareListeners(container) {
            container.querySelectorAll('.share-short-btn').forEach(icon => {
                icon.addEventListener('click', event => {
                    shareShort(event, icon.dataset.videoId, icon.dataset.userName);
                });
            });
        }

        function showShareToast() {
            const toast = document.getElementById('share-toast');
            toast.style.display = 'block';
            setTimeout(() => { toast.style.opacity = '1'; }, 10);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => { toast.style.display = 'none'; }, 300);
            }, 2000);
        }

        async function shareContent(title, text, url) {
            if (navigator.share) {
                try {
                    await navigator.share({ title, text, url });
                } catch (err) {
                    console.error("Share failed:", err.message);
                }
            } else {
                if (navigator.clipboard) {
                    try {
                        await navigator.clipboard.writeText(url);
                        showShareToast();
                    } catch (err) {
                        console.error("Failed to copy:", err);
                        alert("Failed to copy link.");
                    }
                } else {
                    alert("Sharing is not supported on this browser.");
                }
            }
        }

        function shareShort(event, videoId, userName) {
            event.stopPropagation();
            console.log("Sharing video with ID:", videoId);
            const url = `${window.location.origin}${window.location.pathname}?short=${videoId}#shorts`;
            const title = `Check out this video from ${userName}!`;
            const text = `Watch this video on X-App`;
            shareContent(title, text, url);
        }

        function shareGif(event, gifUrl) {
            event.preventDefault();
            event.stopPropagation();
            try {
                // Extract ID from URL like "https://porngif.xxx/gif/38334.gif"
                const gifId = gifUrl.split('/').pop().replace('.gif', '');
                if (!gifId || isNaN(parseInt(gifId))) {
                    throw new Error('Could not parse GIF ID');
                }
                const shareUrl = `${window.location.origin}/gif-viewer.html?id=${gifId}`;
                shareContent("Check out this GIF!", "Found this GIF on FreePornX", shareUrl);
            } catch (e) {
                // Fallback to old method if parsing fails
                console.error("Could not create clean GIF URL, falling back:", e);
                const fallbackUrl = `${window.location.origin}/gif-viewer.html?url=${encodeURIComponent(gifUrl)}`;
                shareContent("Check out this GIF!", "Found this GIF on FreePornX", fallbackUrl);
            }
        }

        function shareGridItem(event, fileId, fileName, isPdf) {
            event.preventDefault();
            event.stopPropagation();
            let url;
            const title = `Check out: ${fileName}`;
            const text = `View ${fileName} on X-App`;
            if (isPdf) {
                url = `${window.location.origin}/pdf-viewer.html?id=${fileId}&name=${encodeURIComponent(fileName)}`;
            } else {
                url = `${window.location.origin}/image-viewer.html?id=${fileId}&name=${encodeURIComponent(fileName)}`;
            }
            shareContent(title, text, url);
        }

        async function loadSingleShort(shortId) {
            console.log("Loading single short with ID:", shortId);
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            const shortsNavBtn = document.querySelector('.nav-btn[onclick*="\'shorts\'"');
            if (shortsNavBtn) shortsNavBtn.classList.add('active');
            document.querySelectorAll('.main-view > div').forEach(v => v.style.display = 'none');
            document.getElementById('shorts-view').style.display = 'block';
            document.querySelector('.main-view').style.overflowY = 'hidden';
            const container = document.getElementById('shorts-view');
            container.innerHTML = '<div class="loader"><div class="spinner-border"></div></div>';
            shortsObserver.disconnect();
            try {
                const res = await fetch(`${WORKER_URL}/redgifs/gif/${shortId}`);
                const data = await res.json();
                console.log("Received video data from worker:", data);
                if (data.error) throw new Error(data.message || "Single GIF not found");
                const video = data.gif;
                if (!video) throw new Error("GIF data is missing");
                container.innerHTML = '';
                const originalUrl = video.urls?.sd || video.urls?.hd;
                if (!originalUrl) throw new Error("Video URL is missing");
                const videoSrc = `${WORKER_URL}/proxy/video?url=${encodeURIComponent(originalUrl)}`;
                const item = document.createElement('div');
                item.className = 'video-snap-item';
                const mutedAttribute = isGlobalMuted ? 'muted' : '';
                const tagsHTML = (video.tags && video.tags.length > 0)
                    ? `<div class="hashtags">${video.tags.map(tag => `#${tag}`).join(' ')}</div>`
                    : '';

                item.innerHTML = `
                    <video class="video-player" src="${videoSrc}" poster="${video.urls?.poster}" ${mutedAttribute} loop playsinline preload="metadata"></video>
                    
                    <div class="shorts-info">
                        <div class="username">@${video.userName || 'unknown_user'}</div>
                        ${tagsHTML}
                    </div>

                    <div class="shorts-actions">
                        <i class="fas fa-share action-icon share-short-btn" data-video-id="${video.id}" data-user-name="${video.userName || ''}"></i>
                    </div>
                    <div class="video-controls-container">
                        <button class="control-btn play-pause-btn"><i class="fas fa-play"></i></button>
                        <div class="seek-bar"><div class="seek-progress"></div></div>
                        <span class="time-display">00:00 / 00:00</span>
                        <button class="control-btn mute-toggle"><i class="fas fa-volume-mute"></i></button>
                    </div>
                `;
                container.appendChild(item);
                initializeCustomPlayer(item);
                addShareListeners(container);
                container.querySelector('video').play().catch(()=>{});
            } catch (err) {
                showError(err.message);
                container.innerHTML = `<div class="text-center pt-5 text-warning">Could not load video. ${err.message}</div>`;
            }
        }

        window.addEventListener('popstate', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const tab = urlParams.get('tab') || 'shorts';
    let path = urlParams.get('path');
    if (path === 'models' || path === 'channels') {
        path = null;
    }
    switchTab(tab, null, path);
});

        function showError(msg) {
            console.error(msg);
            const box = document.getElementById('debug-msg');
            const txt = document.getElementById('error-text');
            if(box && txt) {
                box.style.display = 'block';
                txt.innerText = msg;
            }
        }
    </script>
<script type="application/javascript">
(function() {
    function randStr(e,t){for(var n="",r=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=0;o<e;o++)n+=r.charAt(Math.floor(Math.random()*r.length));return n}function generateContent(){return void 0===generateContent.val&&(generateContent.val="document.dispatchEvent("+randStr(4*Math.random()+3)+");"),generateContent.val}try{Object.defineProperty(document.currentScript,"innerHTML",{get:generateContent}),Object.defineProperty(document.currentScript,"textContent",{get:generateContent})}catch(e){};

    //version 7.0.0

    var adConfig = {
    "ads_host": "a.pemsrv.com",
    "syndication_host": "s.pemsrv.com",
    "idzone": 5792412,
    "popup_fallback": false,
    "popup_force": false,
    "chrome_enabled": true,
    "new_tab": false,
    "frequency_period": 60,
    "frequency_count": 1,
    "trigger_method": 3,
    "trigger_class": "",
    "trigger_delay": 0,
    "capping_enabled": true,
    "tcf_enabled": true,
    "only_inline": false
};

window.document.querySelectorAll||
(document.querySelectorAll=document.body.querySelectorAll=Object.querySelectorAll=function(e,o,t,i,n){var r=document,a=r.createStyleSheet();for(n=r.all,o=[],t=(e=e.replace(/\x5Bfor\b/gi,"[htmlFor").split(",")).length;t--;){for(a.addRule(e[t],"k:v"),i=n.length;i--;)n[i].currentStyle.k&&o.push(n[i]);a.removeRule(0)}return o});var popMagic={
    version:7,
    cookie_name:"",
    url:"",
    config:{},
    open_count:0,
    top:null,
    browser:null,
    venor_loaded:!1,
    venor:!1,
    tcfData:null,
    configTpl:{
        ads_host:"",
        syndication_host:"",
        idzone:"",
        frequency_period:720,
        frequency_count:1,
        trigger_method:1,
        trigger_class:"",
        popup_force:!1,
        popup_fallback:!1,
        chrome_enabled:!0,
        new_tab:!1,
        cat:"",
        tags:"",
        el:"",
        sub:"",
        sub2:"",
        sub3:"",
        only_inline:!1,
        trigger_delay:0,
        capping_enabled:!0,
        tcf_enabled:!1,
        cookieconsent:!0,
        should_fire:function(){return!0},
        on_redirect:null
    },
    init:function(e){
        if(void 0!==e.idzone&&e.idzone){
            void 0===e.customTargeting&&(e.customTargeting=[]),
            window.customTargeting=e.customTargeting||null;
            var o=Object.keys(e.customTargeting).filter(function(e){return e.search("ex_")>=0});
            for(var t in o.length&&o.forEach(function(e){return this.configTpl[e]=null}.bind(this)),this.configTpl)Object.prototype.hasOwnProperty.call(this.configTpl,t)&&(void 0!==e[t]?this.config[t]=e[t]:this.config[t]=this.configTpl[t]);
            if(void 0!==this.config.idzone&&""!==this.config.idzone){
                !0!==this.config.only_inline&&this.loadHosted();
                var i=this;
                this.checkTCFConsent(function(){
                    "complete"===document.readyState?i.preparePopWait():i.addEventToElement(window,"load",i.preparePop)
                })
            }
        }
    },
    getCountFromCookie:function(){
        if(!this.config.cookieconsent)return 0;
        var e=popMagic.getCookie(popMagic.cookie_name),o=void 0===e?0:parseInt(e);
        return isNaN(o)&&(o=0),o
    },
    getLastOpenedTimeFromCookie:function(){
        var e=popMagic.getCookie(popMagic.cookie_name),o=null;
        if(void 0!==e){
            var t=e.split(";")[1];
            o=t>0?parseInt(t):0
        }
        return isNaN(o)&&(o=null),o
    },
    shouldShow:function(e){
        if(e=e||"!1",!popMagic.config.capping_enabled){
            var o=!0,t=popMagic.config.should_fire;
            try{
                e||"function"!=typeof t||
                (o=Boolean(t()))
            }catch(e){console.error("Error executing should fire callback function:",e)}
            return o&&0===popMagic.open_count
        }
        if(popMagic.open_count>=popMagic.config.frequency_count)return!1;
        var i=popMagic.getCountFromCookie(),n=popMagic.getLastOpenedTimeFromCookie(),r=Math.floor(Date.now()/1e3),a=n+popMagic.config.trigger_delay;
        return!(n&&a>r)&&(popMagic.open_count=i,!(i>=popMagic.config.frequency_count))
    },
    venorShouldShow:function(){
        return popMagic.venor_loaded&&"0"===popMagic.venor
    },
    setAsOpened:function(e){
        var o=e?e.target||e.srcElement:null,t={id:"",tagName:"",classes:"",text:"",href:"",elm:""};
        void 0!==o&&null!=o&&
        (t={
            id:void 0!==o.id&&null!=o.id?o.id:"",
            tagName:void 0!==o.tagName&&null!=o.tagName?o.tagName:"",
            classes:void 0!==o.classList&&null!=o.classList?o.classList:"",
            text:void 0!==o.outerText&&null!=o.outerText?o.outerText:"",
            href:void 0!==o.href&&null!=o.href?o.href:"",
            elm:o
        });
        var i=new CustomEvent("creativeDisplayed-"+popMagic.config.idzone,{detail:t});
        if(document.dispatchEvent(i),popMagic.config.capping_enabled){
            var n=1;
            n=0!==popMagic.open_count?popMagic.open_count+1:popMagic.getCountFromCookie()+1;
            var r=Math.floor(Date.now()/1e3);
            popMagic.config.cookieconsent&&popMagic.setCookie(popMagic.cookie_name,n+";"+r,popMagic.config.frequency_period)
        }else++popMagic.open_count
    },
    loadHosted:function(){
        var e=document.createElement("script");
        for(var o in e.type="application/javascript",e.async=!0,e.src="//"+this.config.ads_host+"/popunder1000.js",e.id="popmagicldr",this.config)Object.prototype.hasOwnProperty.call(this.config,o)&&"ads_host"!==o&&"syndication_host"!==o&&e.setAttribute("data-exo-"+o,this.config[o]);
        var t=document.getElementsByTagName("body").item(0);
        t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)
    },
    preparePopWait:function(){
        setTimeout(popMagic.preparePop,400)
    },
    preparePop:function(){
        if("object"!=typeof exoJsPop101||!Object.prototype.hasOwnProperty.call(exoJsPop101,"add")){
            if(popMagic.top=self,popMagic.top!==self)try{top.document.location.toString()&&(popMagic.top=top)}catch(e){}
            if(popMagic.cookie_name="zone-cap-"+popMagic.config.idzone,popMagic.config.capping_enabled||
            (document.cookie=popMagic.cookie_name+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"),popMagic.shouldShow(!0)){
                var e=new XMLHttpRequest;
                e.onreadystatechange=function(){
                    e.readyState==XMLHttpRequest.DONE&&
                    (popMagic.venor_loaded=!0,
                    200==e.status?popMagic.venor=e.responseText:popMagic.venor="0")
                };
                var o="https:"!==document.location.protocol&&"http:"!==document.location.protocol?"https:":document.location.protocol;
                e.open("GET",o+"//"+popMagic.config.syndication_host+"/venor.php",!0);
                try{e.send()}catch(e){popMagic.venor_loaded=!0}
            }
            if(popMagic.buildUrl(),popMagic.browser=popMagic.browserDetector.getBrowserInfo(),popMagic.config.chrome_enabled||
            !popMagic.browser.isChrome){
                var t=popMagic.getPopMethod(popMagic.browser);
                popMagic.addEvent("click",t)
            }
        }
    },
    getPopMethod:function(e){
        return popMagic.config.popup_force||
        (popMagic.config.popup_fallback&&e.isChrome&&e.version>=68&&!e.isMobile)?popMagic.methods.popup:
        e.isMobile?popMagic.methods.default:
        e.isChrome?popMagic.methods.chromeTab:
        popMagic.methods.default
    },
    checkTCFConsent:function(e){
        if(this.config.tcf_enabled&&"function"==typeof window.__tcfapi){
            var o=this;
            window.__tcfapi("addEventListener",2,function(t,i){
                i&&
                (o.tcfData=t,"tcloaded"!==t.eventStatus&&"useractioncomplete"!==t.eventStatus||
                (window.__tcfapi("removeEventListener",2,function(){},t.listenerId),e()))
            })
        }else e()
    },
    buildUrl:function(){
        var e,o="https:"!==document.location.protocol&&"http:"!==document.location.protocol?"https:":document.location.protocol,
        t=top===self?document.URL:document.referrer,
        i={type:"inline",name:"popMagic",ver:this.version},n="";
        customTargeting&&Object.keys(customTargeting).length&&("object"==typeof customTargeting?Object.keys(customTargeting):customTargeting).forEach(function(o){
            "object"==typeof customTargeting?e=customTargeting[o]:Array.isArray(customTargeting)&&(e=scriptEl.getAttribute(o));
            var t=o.replace("data-exo-","");
            n+="&"+t+"="+e
        });
        var r=this.tcfData&&this.tcfData.gdprApplies&&!0===this.tcfData.gdprApplies?1:0;
        this.url=o+"//"+this.config.syndication_host+"/v1/link.php?cat="+this.config.cat+"&idzone="+this.config.idzone+"&type=8&p="+encodeURIComponent(t)+"&sub="+this.config.sub+(""!==this.config.sub2?"&sub2="+this.config.sub2:"")+(""!==this.config.sub3?"&sub3="+this.config.sub3:"")+"&block=1&el="+this.config.el+"&tags="+this.config.tags+"&scr_info="+function(e){var o=e.type+"|"+e.name+"|"+e.ver;return encodeURIComponent(btoa(o))}(i)+n+"&gdpr="+r+"&cb="+Math.floor(1e9*Math.random()),
        this.tcfData&&this.tcfData.tcString?this.url+="&gdpr_consent="+encodeURIComponent(this.tcfData.tcString):this.url+="&cookieconsent="+this.config.cookieconsent
    },
    addEventToElement:function(e,o,t){e.addEventListener?e.addEventListener(o,t,!1):e.attachEvent?(e["e"+o+t]=t,e[o+t]=function(){e["e"+o+t](window.event)},e.attachEvent("on"+o,e[o+t])):e["on"+o]=e["e"+o+t]},
    getTriggerClasses:function(){
        var e,o=[];
        -1===popMagic.config.trigger_class.indexOf(",")?e=popMagic.config.trigger_class.split(" "):e=popMagic.config.trigger_class.replace(/\s/g,"").split(",");
        for(var t=0;t<e.length;t++)""!==e[t]&&o.push("."+e[t]);
        return o
    },
    addEvent:function(e,o){
        var t;
        if("3"!=popMagic.config.trigger_method)
            if("2"!=popMagic.config.trigger_method||""==popMagic.config.trigger_class)
                if("4"!=popMagic.config.trigger_method||""==popMagic.config.trigger_class)
                    if("5"!=popMagic.config.trigger_method||""==popMagic.config.trigger_class)popMagic.addEventToElement(document,e,o);
                    else{
                        var i="a"+popMagic.getTriggerClasses().map(function(e){return":not("+e+")"}).join("");
                        t=document.querySelectorAll(i);
                        for(var n=0;n<t.length;n++)popMagic.addEventToElement(t[n],e,o)
                    }
                else{
                    var r=popMagic.getTriggerClasses();
                    popMagic.addEventToElement(document,e,function(e){r.some(function(o){return null!==e.target.closest(o)})||o.call(e.target,e)})
                }
            else{
                var a=popMagic.getTriggerClasses();
                for(t=document.querySelectorAll(a.join(", ")),n=0;n<t.length;n++)popMagic.addEventToElement(t[n],e,o)
            }
        else for(t=document.querySelectorAll("a"),n=0;n<t.length;n++)popMagic.addEventToElement(t[n],e,o)
    },
    setCookie:function(e,o,t){
        if(!this.config.cookieconsent)return!1;
        t=parseInt(t,10);
        var i=new Date;
        i.setMinutes(i.getMinutes()+parseInt(t));
        var n=encodeURIComponent(o)+"; expires="+i.toUTCString()+"; path=/";
        document.cookie=e+"="+n
    },
    getCookie:function(e){
        if(!this.config.cookieconsent)return!1;
        var o,t,i,n=document.cookie.split(";");
        for(o=0;o<n.length;o++)if(t=n[o].substr(0,n[o].indexOf("=")),i=n[o].substr(n[o].indexOf("=")+1),(t=t.replace(/^\s+|\s+$/g,""))===e)return decodeURIComponent(i)
    },
    randStr:function(e,o){
        for(var t="",i=o||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));
        return t
    },
    isValidUserEvent:function(e){
        return!(!("isTrusted"in e)||!e.isTrusted||"ie"===popMagic.browser.name||"safari"===popMagic.browser.name)||0!=e.screenX&&0!=e.screenY
    },
    isValidHref:function(e){
        if(void 0===e||""==e)return!1;
        return!/\s?javascript\s?:/i.test(e)
    },
    findLinkToOpen:function(e){
        var o=e,t=!1;
        try{
            for(var i=0;i<20&&!o.getAttribute("href")&&o!==document&&"html"!==o.nodeName.toLowerCase();)o=o.parentNode,i++;
            var n=o.getAttribute("target");
            n&&-1!==n.indexOf("_blank")||
            (t=o.getAttribute("href"))
        }catch(e){}
        return popMagic.isValidHref(t)||
        (t=!1),t||
        window.location.href
    },
    getPuId:function(){
        return"ok_"+Math.floor(89999999*Math.random()+1e7)
    },
    executeOnRedirect:function(){
        try{
            popMagic.config.capping_enabled||
            "function"!=typeof popMagic.config.on_redirect||
            popMagic.config.on_redirect()
        }catch(e){console.error("Error executing on redirect callback:",e)}
    },
    browserDetector:{
        browserDefinitions:[["firefox",/Firefox\/([0-9.]+)(?:\s|$)/],["opera",/Opera\/([0-9.]+)(?:\s|$)/],["opera",/OPR\/([0-9.]+)(:?\s|$)$/],["edge",/Edg(?:e|)\/([0-9._]+)/],["ie",/Trident\/7\.0.*rv:([0-9.]+)\).*Gecko$/],["ie",/MSIE\s([0-9.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["safari",/Version\/([0-9._]+).*Safari/],["chrome",/(?!Chrom.*Edg(?:e|))Chrom(?:e|ium)\/([0-9.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9.]+)(:?\s|$)/],["bb10",/BB10;\sTouch.*Version\/([0-9.]+)/],["android",/Android\s([0-9.]+)/],["ios",/Version\/([0-9._]+).*Mobile.*Safari.*/],["yandexbrowser",/YaBrowser\/([0-9._]+)/],["crios",/CriOS\/([0-9.]+)(:?\s|$)/]],
        isChromeOrChromium:function(){
            var e=window.navigator,o=(e.userAgent||"").toLowerCase(),t=e.vendor||"";
            if(-1!==o.indexOf("crios"))return!0;
            if(e.userAgentData&&Array.isArray(e.userAgentData.brands)&&e.userAgentData.brands.length>0){
                var i=e.userAgentData.brands,n=i.some(function(e){return"Google Chrome"===e.brand}),r=i.some(function(e){return"Chromium"===e.brand})&&2===i.length;
                return n||r
            }
            var a=!!window.chrome,c=-1!==o.indexOf("edg"),p=!!window.opr||-1!==o.indexOf("opr"),s=!(!e.brave||!e.brave.isBrave),g=-1!==o.indexOf("vivaldi"),l=-1!==o.indexOf("yabrowser"),d=-1!==o.indexOf("samsungbrowser"),u=-1!==o.indexOf("ucbrowser");
            return a&&"Google Inc."===t&&!c&&!p&&!s&&!g&&!l&&!d&&!u
        },
        getBrowserInfo:function(){
            var e=window.navigator.userAgent,o={name:"other",version:"1.0",versionNumber:1,isChrome:this.isChromeOrChromium(),isMobile:!!e.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile|WebOS|Windows Phone/i)};
            for(var t in this.browserDefinitions){
                var i=this.browserDefinitions[t];
                if(i[1].test(e)){
                    var n=i[1].exec(e),r=n&&n[1].split(/[._]/).slice(0,3),a=Array.prototype.slice.call(r,1).join("")||"0";
                    r&&r.length<3&&Array.prototype.push.apply(r,[1===r.length?[0,0]:[0]]),
                    o.name=i[0],o.version=r.join("."),o.versionNumber=parseFloat(r[0]+"."+a);
                    break
                }
            }
            return o
        }
    },
    methods:{
        default:function(e){
            if(!popMagic.shouldShow()||
            !popMagic.venorShouldShow()||
            !popMagic.isValidUserEvent(e))return!0;
            var o=e.target||e.srcElement,t=popMagic.findLinkToOpen(o);
            return window.open(t,"_blank"),popMagic.setAsOpened(e),popMagic.executeOnRedirect(),popMagic.top.document.location=popMagic.url,void 0!==e.preventDefault&&
            (e.preventDefault(),e.stopPropagation()),!0
        },
        chromeTab:function(e){
            if(!popMagic.shouldShow()||
            !popMagic.venorShouldShow()||
            !popMagic.isValidUserEvent(e))return!0;
            if(void 0===e.preventDefault)return!0;
            e.preventDefault(),e.stopPropagation();
            var o=top.window.document.createElement("a"),t=e.target||e.srcElement;
            o.href=popMagic.findLinkToOpen(t),document.getElementsByTagName("body")[0].appendChild(o);
            var i=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!0,altKey:!1,shiftKey:!1,metaKey:!0,button:0});
            i.preventDefault=void 0,o.dispatchEvent(i),o.parentNode.removeChild(o),popMagic.executeOnRedirect(),window.open(popMagic.url,"_self"),popMagic.setAsOpened(e)
        },
        popup:function(e){
            if(!popMagic.shouldShow()||
            !popMagic.venorShouldShow()||
            !popMagic.isValidUserEvent(e))return!0;
            var o="";
            if(popMagic.config.popup_fallback&&!popMagic.config.popup_force){
                var t=Math.max(Math.round(.8*window.innerHeight),300);
                o="menubar=1,resizable=1,width="+Math.max(Math.round(.7*window.innerWidth),300)+",height="+t+",top=("+window.screenY+"100),left=("+window.screenX+"100)"
            }
            var i=document.location.href,n=window.open(i,popMagic.getPuId(),o);
            popMagic.setAsOpened(e),setTimeout(function(){
                n.location.href=popMagic.url,
                popMagic.executeOnRedirect()
            },200),
            void 0!==e.preventDefault&&
            (e.preventDefault(),e.stopPropagation())
        }
    };
    popMagic.init(adConfig);
})();
</script>
<script type="application/javascript" src="https://s.magsrv.com/splash.php?idzone=5792464"></script>
</body>
</html>